class ConfiguracionManager{constructor(){this.csrf=document.querySelector('meta[name="csrf-token"]')?.getAttribute('content')||'';this.routes=window.configRoutes||{};this.saveTimeout=null;this.init()}init(){this.setupAnimations();this.setupRealtimeSave();console.log('✅ ConfiguracionManager (Tiempo Real) initialized')}setupAnimations(){const items=document.querySelectorAll('.config-section, .danger-zone');items.forEach((item,index)=>{item.style.animationDelay=`${index*0.1}s`})}setupRealtimeSave(){const switches=document.querySelectorAll('.form-switch-modern input[type="checkbox"]');switches.forEach(input=>{input.addEventListener('change',()=>{this.saveConfig(input.name,input.checked?1:0)})})}saveConfig(field,value){this.showSaving();clearTimeout(this.saveTimeout);this.saveTimeout=setTimeout(()=>{fetch(this.routes.updateRealtime,{method:'POST',headers:{'X-CSRF-TOKEN':this.csrf,'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({field:field,value:value})}).then(response=>response.json()).then(data=>{if(data.success){this.showSaved();this.showToast('success',data.message||'Configuración guardada')}else{this.showToast('error','Error al guardar')}}).catch(error=>{console.error('Error:',error);this.showToast('error','Error de conexión')})},500)}showSaving(){const saveStatus=document.getElementById('saveStatus');const savingStatus=document.getElementById('savingStatus');if(saveStatus)saveStatus.style.display='none';if(savingStatus)savingStatus.style.display='block'}showSaved(){const saveStatus=document.getElementById('saveStatus');const savingStatus=document.getElementById('savingStatus');if(savingStatus)savingStatus.style.display='none';if(saveStatus){saveStatus.style.display='block';setTimeout(()=>{saveStatus.style.display='none'},3000)}}showToast(type,message,duration=3000){const toast=document.createElement('div');toast.className=`config-toast config-toast-${type}`;const iconMap={success:'✓',error:'✕'};const icon=iconMap[type]||'ℹ';toast.innerHTML=`<div class="config-toast-content"><span class="config-toast-icon">${icon}</span><span class="config-toast-message">${message}</span></div>`;document.body.appendChild(toast);setTimeout(()=>toast.classList.add('active'),10);setTimeout(()=>{toast.classList.remove('active');setTimeout(()=>toast.remove(),300)},duration)}}window.exportarDatos=function(){const confirmExport=confirm('¿Deseas exportar todos tus datos? Se descargará un archivo JSON con tu información.');if(confirmExport){const manager=window.configuracionManager;manager.showToast('success','Exportación iniciada...');setTimeout(()=>{const data={mensaje:'Esta funcionalidad estará disponible próximamente',usuario:'Tu información personal',configuraciones:'Tus preferencias',fecha:new Date().toISOString()};const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`mis-datos-${Date.now()}.json`;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url)},1000)}};window.resetearConfiguracion=function(){const confirmReset=confirm('⚠️ ADVERTENCIA\n\n¿Estás seguro de que deseas restablecer TODA tu configuración a los valores predeterminados?\n\nEsta acción NO se puede deshacer.');if(confirmReset){const doubleConfirm=confirm('Esta es tu última oportunidad para cancelar.\n\n¿Realmente deseas continuar?');if(doubleConfirm){const manager=window.configuracionManager;manager.showSaving();fetch(manager.routes.reset,{method:'POST',headers:{'X-CSRF-TOKEN':manager.csrf,'Content-Type':'application/json','Accept':'application/json'}}).then(response=>response.json()).then(data=>{if(data.success){manager.showToast('success','Configuración restablecida. Recargando...',2000);setTimeout(()=>location.reload(),2000)}else{manager.showToast('error','Error al restablecer')}}).catch(error=>{console.error('Error:',error);manager.showToast('error','Error de conexión')})}}};document.addEventListener('DOMContentLoaded',function(){window.configuracionManager=new ConfiguracionManager()});
