class RendimientoManager{constructor(){this.toastTimeout=null;this.loadingElement=null;this.init()}init(){this.createLoadingOverlay();this.initAnimations();this.initFilters();this.initCharts();this.initEventListeners();document.addEventListener('keydown',e=>{if(e.key==='Escape'){this.closeAllModals()}})}createLoadingOverlay(){const loading=document.createElement('div');loading.className='rendimiento-loading';loading.innerHTML='<div class="rendimiento-spinner"></div>';document.body.appendChild(loading);this.loadingElement=loading}showLoading(){if(this.loadingElement){this.loadingElement.classList.add('active')}}hideLoading(){if(this.loadingElement){this.loadingElement.classList.remove('active')}}showToast(message,type='success'){this.hideToast();const toast=document.createElement('div');toast.className=`rendimiento-toast ${type}`;const icons={success:'✓',error:'✕',warning:'⚠',info:'ℹ'};toast.innerHTML=`
        <div class="rendimiento-toast-icon">${icons[type]||icons.info}</div>
        <div class="rendimiento-toast-content">
            <p class="rendimiento-toast-message">${message}</p>
        </div>
        <button class="rendimiento-toast-close" onclick="rendimientoManager.hideToast()">×</button>
    `;document.body.appendChild(toast);setTimeout(()=>toast.classList.add('show'),10);this.toastTimeout=setTimeout(()=>this.hideToast(),5000)}hideToast(){const toast=document.querySelector('.rendimiento-toast');if(toast){toast.classList.remove('show');setTimeout(()=>toast.remove(),300)}if(this.toastTimeout){clearTimeout(this.toastTimeout)}}initAnimations(){this.animateProgressBars();const cards=document.querySelectorAll('.rendimiento-stat-card, .rendimiento-member-card, .rendimiento-ranking-item');cards.forEach((el,index)=>{el.style.opacity='1';el.style.animation=`fadeInUp 0.6s ease-out ${index*0.05}s forwards`})}animateProgressBars(){const progressBars=document.querySelectorAll('.rendimiento-progress-bar');progressBars.forEach(bar=>{const width=bar.style.width||'0%';bar.style.width='0%';setTimeout(()=>{bar.style.width=width},100)})}initFilters(){const periodoSelect=document.querySelector('select[name="periodo"]');if(periodoSelect){periodoSelect.addEventListener('change',()=>{this.showLoading();periodoSelect.closest('form').submit()})}}initCharts(){if(typeof Chart==='undefined')return;const chartCanvas=document.getElementById('evolucionChart');if(!chartCanvas)return;this.setupEvolucionChart(chartCanvas)}setupEvolucionChart(canvas){const ctx=canvas.getContext('2d');const evolucionData=window.evolucionMetricas||[];if(!evolucionData.length)return;new Chart(ctx,{type:'line',data:{labels:evolucionData.map(item=>item.mes),datasets:[{label:'Ventas ($)',data:evolucionData.map(item=>item.ventas),borderColor:'#722F37',backgroundColor:'rgba(114, 47, 55, 0.1)',borderWidth:3,fill:true,tension:.4,pointRadius:5,pointHoverRadius:8,pointBackgroundColor:'#722F37',pointBorderColor:'#fff',pointBorderWidth:2},{label:'Cantidad de Ventas',data:evolucionData.map(item=>item.cantidad),borderColor:'#198754',backgroundColor:'rgba(25, 135, 84, 0.1)',borderWidth:2,fill:false,tension:.4,yAxisID:'y1',pointRadius:4,pointHoverRadius:7,pointBackgroundColor:'#198754',pointBorderColor:'#fff',pointBorderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{position:'top',labels:{padding:15,font:{size:12,weight:'600'},usePointStyle:true}},tooltip:{backgroundColor:'rgba(0, 0, 0, 0.8)',padding:12,titleFont:{size:13,weight:'bold'},bodyFont:{size:12},bodySpacing:6,cornerRadius:8,displayColors:true,callbacks:{label:function(context){let label=context.dataset.label||'';if(label){label+=': '}if(context.parsed.y!==null){if(context.datasetIndex===0){label+='$'+context.parsed.y.toLocaleString()}else{label+=context.parsed.y}}return label}}}},scales:{y:{type:'linear',display:true,position:'left',title:{display:true,text:'Ventas ($)',font:{size:12,weight:'600'},color:'#722F37'},ticks:{callback:function(value){return'$'+value.toLocaleString()},color:'#6c757d',font:{size:11}},grid:{color:'rgba(0, 0, 0, 0.05)',drawBorder:false}},y1:{type:'linear',display:true,position:'right',title:{display:true,text:'Cantidad',font:{size:12,weight:'600'},color:'#198754'},ticks:{color:'#6c757d',font:{size:11},stepSize:1},grid:{drawOnChartArea:false,drawBorder:false}}},animation:{duration:1500,easing:'easeInOutQuart'}}})}initEventListeners(){document.querySelectorAll('.rendimiento-stat-card').forEach(card=>{card.addEventListener('click',()=>{const value=card.querySelector('.rendimiento-stat-value').textContent;const label=card.querySelector('.rendimiento-stat-label').textContent;console.log(`Stat clicked: ${label} - ${value}`)})});document.querySelectorAll('.rendimiento-member-card').forEach(card=>{card.addEventListener('click',()=>{const name=card.querySelector('.rendimiento-member-name').textContent;console.log(`Member clicked: ${name}`)})});const rankingItems=document.querySelectorAll('.rendimiento-ranking-item');rankingItems.forEach((item,index)=>{item.style.animationDelay=`${index*0.1}s`})}exportData(format='csv'){this.showLoading();this.showToast('Generando archivo CSV...','info');const form=document.querySelector('form[action*="rendimiento.index"]');const periodo=form?form.querySelector('select[name="periodo"]').value:'mes';const url=`/lider/rendimiento/exportar?periodo=${periodo}`;window.location.href=url;setTimeout(()=>{this.hideLoading();this.showToast('Archivo descargado correctamente','success')},2000)}refreshData(){this.showLoading();this.showToast('Actualizando datos...','info');setTimeout(()=>{location.reload()},1000)}filterByPeriod(period){const form=document.querySelector('form');const periodoSelect=form.querySelector('select[name="periodo"]');if(periodoSelect){periodoSelect.value=period;this.showLoading();form.submit()}}closeAllModals(){}}const rendimientoManager=new RendimientoManager();document.addEventListener('DOMContentLoaded',()=>{if(window.evolucionMetricas){console.log('Datos de evolución cargados:',window.evolucionMetricas)}});