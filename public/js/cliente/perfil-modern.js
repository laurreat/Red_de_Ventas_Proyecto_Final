/**
 * Perfil del Cliente - JavaScript Moderno
 * Versi칩n: 2.0 - Optimizado para PWA y Rendimiento
 */

class PerfilManager{constructor(){this.init()}init(){this.setupTabs();this.setupModals();this.setupImageUpload();this.initAnimations();this.handleEscKey()}setupTabs(){const tabs=document.querySelectorAll('.perfil-tab');const contents=document.querySelectorAll('.perfil-tab-content');tabs.forEach(tab=>{tab.addEventListener('click',()=>{const targetId=tab.getAttribute('data-tab');tabs.forEach(t=>t.classList.remove('active'));contents.forEach(c=>c.classList.remove('active'));tab.classList.add('active');const targetContent=document.getElementById(targetId);if(targetContent){targetContent.classList.add('active')}})})}setupModals(){document.querySelectorAll('.modal-overlay').forEach(modal=>{modal.addEventListener('click',e=>{if(e.target===modal){this.closeModal(modal.id)}})})}setupImageUpload(){const input=document.getElementById('fotoInput');if(input){input.addEventListener('change',e=>{if(e.target.files&&e.target.files[0]){const file=e.target.files[0];if(file.size>5242880){showToast('La imagen no debe superar 5MB','error');return}const reader=new FileReader();reader.onload=e=>{const preview=document.querySelector('.perfil-avatar img');if(preview){preview.src=e.target.result}};reader.readAsDataURL(file)}})}}initAnimations(){const statCards=document.querySelectorAll('.stat-card');statCards.forEach((card,index)=>{setTimeout(()=>{card.classList.add('fade-in-up')},index*100)});const cards=document.querySelectorAll('.card');cards.forEach((card,index)=>{setTimeout(()=>{card.classList.add('fade-in-up')},index*150)})}handleEscKey(){document.addEventListener('keydown',e=>{if(e.key==='Escape'){document.querySelectorAll('.modal-overlay.active').forEach(modal=>{this.closeModal(modal.id)})}})}showModal(modalId,type='primary'){const modal=document.getElementById(modalId);if(modal){modal.classList.add('active');document.body.style.overflow='hidden'}}closeModal(modalId){const modal=document.getElementById(modalId);if(modal){modal.classList.remove('active');document.body.style.overflow='';const form=modal.querySelector('form');if(form){form.reset()}}}}function showEditModal(){perfilManager.showModal('editModal')}function closeEditModal(){perfilManager.closeModal('editModal')}function showPasswordModal(){perfilManager.showModal('passwordModal')}function closePasswordModal(){perfilManager.closeModal('passwordModal')}function handleAvatarUpload(input){if(input.files&&input.files[0]){if(!input.files[0].type.match('image.*')){showToast('Por favor selecciona una imagen v치lida','error');return}if(input.files[0].size>5242880){showToast('La imagen no debe superar 5MB','error');input.value='';return}const form=input.closest('form');if(form){showLoading('Subiendo foto...');form.submit()}}}function showToast(message,type='info'){const container=document.getElementById('toastContainer');if(!container)return;const toast=document.createElement('div');toast.className=`toast toast-${type}`;const icons={success:'bi-check-circle-fill',error:'bi-x-circle-fill',warning:'bi-exclamation-triangle-fill',info:'bi-info-circle-fill'};toast.innerHTML=`<div class="toast-icon"><i class="bi ${icons[type]||icons.info}"></i></div><div class="toast-content"><div class="toast-message">${message}</div></div>`;container.appendChild(toast);setTimeout(()=>toast.classList.add('show'),10);setTimeout(()=>{toast.classList.remove('show');toast.classList.add('hide');setTimeout(()=>toast.remove(),300)},4000)}function showLoading(text='Cargando...'){let overlay=document.querySelector('.loading-overlay');if(!overlay){overlay=document.createElement('div');overlay.className='loading-overlay';overlay.innerHTML=`<div><div class="loading-spinner"></div><div class="loading-text">${text}</div></div>`;document.body.appendChild(overlay)}overlay.classList.add('active')}function hideLoading(){const overlay=document.querySelector('.loading-overlay');if(overlay){overlay.classList.remove('active')}}function showComingSoon(feature){showToast(`${feature} estar치 disponible pr칩ximamente`,'info')}let perfilManager;document.addEventListener('DOMContentLoaded',()=>{perfilManager=new PerfilManager();const forms=document.querySelectorAll('form[action]');forms.forEach(form=>{if(!form.hasAttribute('data-no-loading')){form.addEventListener('submit',()=>{showLoading('Procesando...')})}})});if('serviceWorker'in navigator){window.addEventListener('load',()=>{navigator.serviceWorker.ready.then(()=>{console.log('PWA ready - Perfil del Cliente')})})}
