class AyudaManager{constructor(){if(AyudaManager.instance)return AyudaManager.instance;AyudaManager.instance=this;this.init()}init(){this.setupFAQ();this.setupSearch();this.setupTicketForm()}setupFAQ(){document.querySelectorAll('.ayuda-faq-item').forEach(item=>{item.addEventListener('click',()=>{item.classList.toggle('active')})})}setupSearch(){const form=document.getElementById('searchForm');if(form){form.addEventListener('submit',e=>{e.preventDefault();const query=document.getElementById('searchInput').value;this.buscar(query)})}}buscar(query){if(!query||query.length<3)return;fetch(`/vendedor/ayuda/buscar?q=${encodeURIComponent(query)}`).then(r=>r.json()).then(data=>{if(data.success){this.mostrarResultados(data.resultados)}}).catch(err=>console.error(err))}mostrarResultados(resultados){const container=document.getElementById('searchResults');if(!container)return;if(resultados.length===0){container.innerHTML='<p>No se encontraron resultados</p>';return}container.innerHTML=resultados.map(r=>`<div class="ayuda-faq-item"><div class="ayuda-faq-question">${r.titulo}<i class="bi bi-chevron-down"></i></div><div class="ayuda-faq-answer">${r.contenido}</div></div>`).join('');this.setupFAQ()}setupTicketForm(){const form=document.getElementById('ticketForm');if(form){form.addEventListener('submit',e=>{e.preventDefault();this.enviarTicket()})}}enviarTicket(){const form=document.getElementById('ticketForm');const data={asunto:form.asunto.value,categoria:form.categoria.value,descripcion:form.descripcion.value,prioridad:form.prioridad.value};this.showLoading();fetch('/vendedor/ayuda/ticket',{method:'POST',headers:{'Content-Type':'application/json','X-CSRF-TOKEN':document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify(data)}).then(r=>r.json()).then(data=>{this.hideLoading();if(data.success){this.showToast(data.message,'success');form.reset()}else{this.showToast(data.message||'Error','danger')}}).catch(err=>{this.hideLoading();this.showToast('Error de conexi√≥n','danger');console.error(err)})}showToast(msg,type){const toast=document.createElement('div');toast.className=`notif-toast ${type}`;const icons={success:'bi-check-circle-fill',danger:'bi-exclamation-circle-fill'};toast.innerHTML=`<i class="bi ${icons[type]} notif-toast-icon"></i><div class="notif-toast-content"><div class="notif-toast-message">${msg}</div></div>`;let container=document.querySelector('.notif-toast-container');if(!container){container=document.createElement('div');container.className='notif-toast-container';document.body.appendChild(container)}container.appendChild(toast);setTimeout(()=>toast.remove(),3000)}showLoading(){let overlay=document.querySelector('.notif-loading-overlay');if(!overlay){overlay=document.createElement('div');overlay.className='notif-loading-overlay';overlay.innerHTML='<div class="notif-spinner"></div>';document.body.appendChild(overlay)}overlay.classList.add('active')}hideLoading(){const overlay=document.querySelector('.notif-loading-overlay');if(overlay)overlay.classList.remove('active')}}const ayudaManager=new AyudaManager();
